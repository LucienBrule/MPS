//------------------------------------
// Lab 3 - Part 1: UART - Lab03_uart.c
//------------------------------------
//

/*
 * UART information:
 * 	textbook page 221
 * 	reference manual page 1241
 * 	USART1 and 6 setup in uart.c
 */
#include "init.h"

// Main Execution Loop
int main(void) {
	//Initialize the system
	Sys_Init();
	//Initialize GPIO for UART
	UART_HandleTypeDef uart6;
	initUart(&uart6,9600,USART6);
	// Broadcast over both UART that we are starting.
	uart_print(&uart6,"\r\n[printf] UART6 9600\r\n");
	uart_print(&USB_UART,"\r\n[printf] UART1 115200\r\n");
	//start the listen loop
	while(1){
		uint8_t uart1_recv[1], uart6_recv[1];
		// get char from each uart
//		uart1_recv = uart_getchar(&USB_UART,1);
//		uart6_recv = uart_getchar(&uart6,1);

		HAL_UART_Receive(&USB_UART, uart1_recv, 1, 100);
		HAL_UART_Receive(&uart6, uart6_recv, 1, 100);
		printf("\r\n[DEBUG] uart1: %x uart2: %x\r\n",uart1_recv[1], uart6_recv[1]);

		//write char back to own uart
		if(uart1_recv[1] != 0x3c){
			uart_putchar(&USB_UART,&uart1_recv);
			uart_putchar(&uart6,&uart1_recv);

		}
		if(uart6_recv[1] != 0xde){
			uart_putchar(&uart6,&uart6_recv);
			uart_putchar(&USB_UART,&uart6_recv);

		}
		HAL_Delay(100);

	}

}
